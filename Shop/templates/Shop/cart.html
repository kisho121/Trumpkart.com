{% extends 'Shop/layouts/main.html' %}

{% block title %}
Cart|TrumpKart
{% endblock title %}

{% block content %}

{% include 'Shop/inc/message.html' %}

<div class="container-md-fluid py-3">

<h2 class="text-center fw-bolder" style="font-family:serif; color: rgb(4, 9, 90);">
    CART ITEMS <i class="fa-solid fa-cart-shopping"></i>
</h2>

<div class="bg-light my-3">
   {% if cart %}
   <table class="container-fluid table table-striped mb-3 rounded-2">
      <thead>
         <tr class="bg-primary text-light text-uppercase">
            <th colspan="2">Image</th>
            <th colspan="4">Product Name</th>
            <th colspan="2">Price</th>
            <th colspan="1">Qty</th>
            <th colspan="2">Total</th>
            <th colspan="1">Action</th>
         </tr>
      </thead>
      <tbody>
         {% for item in cart %}
         <tr class="my-auto cart-row" data-item-id="{{ item.id }}">
            <td colspan="2">
               <img class="cart-image align-content-center my-0" 
                    src="{{ item.Product.product_image.url }}" 
                    alt="image" width="100px">
            </td>
            <td colspan="4" class="align-content-center">
               <a href="{% url 'collectiondetails' item.Product.category.name item.Product.name %}">
                  {{ item.Product.name }}
               </a>
            </td>
            <td colspan="2" class="align-content-center">₹{{ item.Product.selling_price }}</td>
            <td colspan="1" class="align-content-center">{{ item.product_qty }}</td>
            <td colspan="2" class="price align-content-center">{{ item.total_cost }}</td>
            <td colspan="1" class="align-content-center">
               <button class="btn btn-outline-danger fw-bold delete-btn" 
                       data-item-id="{{ item.id }}"
                       data-product-name="{{ item.Product.name }}">
                  <i class="fa fa-trash"></i>
               </button>
            </td>
         </tr>
         {% endfor %}
         
         <tr>
            <td colspan="7"></td>
            <td colspan="2" class="text-dark fw-bold align-content-center">Total Amount:</td>
            <td colspan="2" id="total" class="text-danger fs-6 text-center fw-bold align-content-center">₹0</td>
            <td colspan="1" class="align-content-center">
               <a href="{% url 'checkout' %}">
                  <button class="btn btn-success h6 fw-bolder text-white buy">
                     CHECKOUT
                  </button>
               </a>
            </td>
         </tr>
      </tbody>
   </table>
   
   {% else %}
   <div class="text-center my-5 py-5">
      <i class="fa fa-shopping-cart" style="font-size: 100px; color: #ccc;"></i>
      <h2 class="mt-3">Your cart is empty</h2>
      <p class="text-muted">Add some products to get started!</p>
      <a href="{% url 'collection' %}" class="btn btn-primary mt-3">
         <i class="fa fa-shopping-bag me-2"></i>Start Shopping
      </a>
   </div>
   {% endif %}

</div>

</div>

{% endblock content %}

{% block scripts %}
<script>
document.addEventListener('DOMContentLoaded', function() {
   // Calculate total price
   function calculateTotal() {
      let price = document.querySelectorAll('.price');
      let node = Array.from(price);
      let result = node.reduce((acc, curr) => {
         return acc += Number(curr.textContent);
      }, 0);
      document.getElementById('total').innerHTML = '₹' + result.toLocaleString('en-IN');
   }
   
   // Initial calculation
   calculateTotal();
   
   // Delete button click handlers
   const deleteButtons = document.querySelectorAll('.delete-btn');
   
   deleteButtons.forEach(button => {
      button.addEventListener('click', function(e) {
         e.preventDefault();
         
         const itemId = this.getAttribute('data-item-id');
         const productName = this.getAttribute('data-product-name');
         
         Swal.fire({
            title: 'Remove from Cart?',
            html: `Are you sure you want to remove<br/><strong>${productName}</strong><br/>from your cart?`,
            icon: 'warning',
            showCancelButton: true,
            confirmButtonColor: '#d33',
            cancelButtonColor: '#6c757d',
            confirmButtonText: '<i class="fa fa-trash me-2"></i>remove',
            cancelButtonText: '<i class="fa fa-times me-2"></i>Cancel',
            reverseButtons: true,
            customClass: {
               confirmButton: 'btn btn-danger btn-lg px-4',
               cancelButton: 'btn btn-secondary btn-lg px-4'
            },
            buttonsStyling: false
         }).then((result) => {
            if (result.isConfirmed) {
               // Show loading
               Swal.fire({
                  title: 'Removing...',
                  allowOutsideClick: false,
                  didOpen: () => {
                     Swal.showLoading();
                  }
               });
               
               // Redirect to remove URL
               window.location.href = `/removecart/${itemId}`;
            }
         });
      });
   });
});
</script>

<style>
.cart-image {
   object-fit: cover;
   border-radius: 8px;
   box-shadow: 0 2px 4px rgba(0,0,0,0.1);
}

.delete-btn {
   transition: all 0.3s ease;
}

.delete-btn:hover {
   transform: scale(1.05);
   box-shadow: 0 4px 8px rgba(220, 53, 69, 0.3);
}

.buy {
   transition: all 0.3s ease;
}

.buy:hover {
   transform: translateY(-2px);
   box-shadow: 0 4px 8px rgba(25, 135, 84, 0.3);
}

table a {
   color: #667eea;
   text-decoration: none;
   font-weight: 500;
   transition: color 0.3s ease;
}

table a:hover {
   color: #764ba2;
   text-decoration: underline;
}

/* SweetAlert2 custom styling */
.swal2-container {
   z-index: 10000;
}

.swal2-popup {
   border-radius: 15px !important;

}

.swal2-title {
   font-size: 1.75rem !important;
   font-weight: 600 !important;
   padding: 0%;
}

.swal2-html-container {
   font-size: 1rem !important;
   line-height: 1.6 !important;
}

.swal2-actions {
   gap: 1rem !important;
   
}

.btn-danger.px-4, .btn-secondary.px-4 {

   font-size: 1rem !important;
   font-weight: 600 !important;
   border-radius: 8px !important;
   transition: all 0.3s ease !important;
}

.btn-danger.px-4:hover {
   transform: translateY(-2px) !important;
   box-shadow: 0 4px 12px rgba(220, 53, 69, 0.4) !important;
}

.btn-secondary.px-4:hover {
   transform: translateY(-2px) !important;
   box-shadow: 0 4px 12px rgba(108, 117, 125, 0.4) !important;
}
</style>
{% endblock scripts %}